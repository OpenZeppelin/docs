---
title: OpenZeppelin Foundry Upgrades API
description: OpenZeppelin Foundry Upgrades API
---

## Contract name formats

Contract names must be provided in specific formats depending on context. The following are the required formats for each context:

### Foundry artifact format

Contexts:

* `contractName` parameter
* `referenceContract` option if `referenceBuildInfoDir` option is not set

Can be in any of the following forms according to Foundry‚Äôs [getCode](https://book.getfoundry.sh/cheatcodes/get-code) cheatcode:

* the Solidity file name, e.g. `ContractV1.sol`
* the Solidity file name and the contract name, e.g. `ContractV1.sol:ContractV1`
* the artifact path relative to the project root directory, e.g. `out/ContractV1.sol/ContractV1.json`

### Annotation format

Contexts:

* `@custom:oz-upgrades-from <reference>` annotation
* `referenceContract` option if `referenceBuildInfoDir` option is set

Can be in any of the following forms according to the [OpenZeppelin Upgrades CLI](https://docs.openzeppelin.com/upgrades-plugins/api-core#define-reference-contracts):

* the contract name, e.g. `ContractV1`
* fully qualified contract name, e.g. `contracts/tokens/ContractV1.sol:ContractV1`

If the `referenceBuildInfoDir` option is set, include the build info directory short name as a prefix, resulting in one of the following forms:

* the build info directory short name and the contract name, e.g. `build-info-v1:ContractV1`
* the build info directory short name and the fully qualified contract name, e.g. `build-info-v1:contracts/tokens/ContractV1.sol:ContractV1`

## Common Options

The following options can be used with some of the below functions. See [Options.sol](https://github.com/OpenZeppelin/openzeppelin-foundry-upgrades/blob/main/src/Options.sol) for detailed descriptions of each option.

### `Options` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Options.sol)

```solidity
import "@openzeppelin/src/Options.sol";
```

<a id="DefenderOptions"></a>

### `DefenderOptions` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Options.sol)

```solidity
import "@openzeppelin/src/Options.sol";
```

<a id="TxOverrides"></a>

### `TxOverrides` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Options.sol)

```solidity
import "@openzeppelin/src/Options.sol";
```

## Upgrades.sol

<a id="Upgrades"></a>

### `Upgrades` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Upgrades.sol)

```solidity
import "@openzeppelin/src/Upgrades.sol";
```

Library for deploying and managing upgradeable contracts from Forge scripts or tests.

NOTE: Requires OpenZeppelin Contracts v5 or higher.

#### Functions
- [deployUUPSProxy(contractName, initializerData, opts)](#Upgrades-deployUUPSProxy-string-bytes-struct-Options-)
- [deployUUPSProxy(contractName, initializerData)](#Upgrades-deployUUPSProxy-string-bytes-)
- [deployTransparentProxy(contractName, initialOwner, initializerData, opts)](#Upgrades-deployTransparentProxy-string-address-bytes-struct-Options-)
- [deployTransparentProxy(contractName, initialOwner, initializerData)](#Upgrades-deployTransparentProxy-string-address-bytes-)
- [upgradeProxy(proxy, contractName, data, opts)](#Upgrades-upgradeProxy-address-string-bytes-struct-Options-)
- [upgradeProxy(proxy, contractName, data)](#Upgrades-upgradeProxy-address-string-bytes-)
- [upgradeProxy(proxy, contractName, data, opts, tryCaller)](#Upgrades-upgradeProxy-address-string-bytes-struct-Options-address-)
- [upgradeProxy(proxy, contractName, data, tryCaller)](#Upgrades-upgradeProxy-address-string-bytes-address-)
- [deployBeacon(contractName, initialOwner, opts)](#Upgrades-deployBeacon-string-address-struct-Options-)
- [deployBeacon(contractName, initialOwner)](#Upgrades-deployBeacon-string-address-)
- [upgradeBeacon(beacon, contractName, opts)](#Upgrades-upgradeBeacon-address-string-struct-Options-)
- [upgradeBeacon(beacon, contractName)](#Upgrades-upgradeBeacon-address-string-)
- [upgradeBeacon(beacon, contractName, opts, tryCaller)](#Upgrades-upgradeBeacon-address-string-struct-Options-address-)
- [upgradeBeacon(beacon, contractName, tryCaller)](#Upgrades-upgradeBeacon-address-string-address-)
- [deployBeaconProxy(beacon, data)](#Upgrades-deployBeaconProxy-address-bytes-)
- [deployBeaconProxy(beacon, data, opts)](#Upgrades-deployBeaconProxy-address-bytes-struct-Options-)
- [validateImplementation(contractName, opts)](#Upgrades-validateImplementation-string-struct-Options-)
- [deployImplementation(contractName, opts)](#Upgrades-deployImplementation-string-struct-Options-)
- [validateUpgrade(contractName, opts)](#Upgrades-validateUpgrade-string-struct-Options-)
- [prepareUpgrade(contractName, opts)](#Upgrades-prepareUpgrade-string-struct-Options-)
- [getAdminAddress(proxy)](#Upgrades-getAdminAddress-address-)
- [getImplementationAddress(proxy)](#Upgrades-getImplementationAddress-address-)
- [getBeaconAddress(proxy)](#Upgrades-getBeaconAddress-address-)

<a id="Upgrades-deployUUPSProxy-string-bytes-struct-Options-"></a>

### `deployUUPSProxy(string contractName, bytes initializerData, struct Options opts) ‚Üí address`
*internal*

Deploys a UUPS proxy using the given contract as the implementation.

<a id="Upgrades-deployUUPSProxy-string-bytes-"></a>

### `deployUUPSProxy(string contractName, bytes initializerData) ‚Üí address`
*internal*

Deploys a UUPS proxy using the given contract as the implementation.

<a id="Upgrades-deployTransparentProxy-string-address-bytes-struct-Options-"></a>

### `deployTransparentProxy(string contractName, address initialOwner, bytes initializerData, struct Options opts) ‚Üí address`
*internal*

Deploys a transparent proxy using the given contract as the implementation.

<a id="Upgrades-deployTransparentProxy-string-address-bytes-"></a>

### `deployTransparentProxy(string contractName, address initialOwner, bytes initializerData) ‚Üí address`
*internal*

Deploys a transparent proxy using the given contract as the implementation.

<a id="Upgrades-upgradeProxy-address-string-bytes-struct-Options-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data, struct Options opts)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeProxy-address-string-bytes-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeProxy-address-string-bytes-struct-Options-address-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data, struct Options opts, address tryCaller)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-upgradeProxy-address-string-bytes-address-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data, address tryCaller)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-deployBeacon-string-address-struct-Options-"></a>

### `deployBeacon(string contractName, address initialOwner, struct Options opts) ‚Üí address`
*internal*

Deploys an upgradeable beacon using the given contract as the implementation.

<a id="Upgrades-deployBeacon-string-address-"></a>

### `deployBeacon(string contractName, address initialOwner) ‚Üí address`
*internal*

Deploys an upgradeable beacon using the given contract as the implementation.

<a id="Upgrades-upgradeBeacon-address-string-struct-Options-"></a>

### `upgradeBeacon(address beacon, string contractName, struct Options opts)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeBeacon-address-string-"></a>

### `upgradeBeacon(address beacon, string contractName)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeBeacon-address-string-struct-Options-address-"></a>

### `upgradeBeacon(address beacon, string contractName, struct Options opts, address tryCaller)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-upgradeBeacon-address-string-address-"></a>

### `upgradeBeacon(address beacon, string contractName, address tryCaller)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-deployBeaconProxy-address-bytes-"></a>

### `deployBeaconProxy(address beacon, bytes data) ‚Üí address`
*internal*

Deploys a beacon proxy using the given beacon and call data.

<a id="Upgrades-deployBeaconProxy-address-bytes-struct-Options-"></a>

### `deployBeaconProxy(address beacon, bytes data, struct Options opts) ‚Üí address`
*internal*

Deploys a beacon proxy using the given beacon and call data.

<a id="Upgrades-validateImplementation-string-struct-Options-"></a>

### `validateImplementation(string contractName, struct Options opts)`
*internal*

Validates an implementation contract, but does not deploy it.

<a id="Upgrades-deployImplementation-string-struct-Options-"></a>

### `deployImplementation(string contractName, struct Options opts) ‚Üí address`
*internal*

Validates and deploys an implementation contract, and returns its address.

<a id="Upgrades-validateUpgrade-string-struct-Options-"></a>

### `validateUpgrade(string contractName, struct Options opts)`
*internal*

Validates a new implementation contract in comparison with a reference contract, but does not deploy it.

Requires that either the `referenceContract` option is set, or the contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-prepareUpgrade-string-struct-Options-"></a>

### `prepareUpgrade(string contractName, struct Options opts) ‚Üí address`
*internal*

Validates a new implementation contract in comparison with a reference contract, deploys the new implementation contract,
and returns its address.

Requires that either the `referenceContract` option is set, or the contract has a `@custom:oz-upgrades-from <reference>` annotation.

Use this method to prepare an upgrade to be run from an admin address you do not control directly or cannot use from your deployment environment.

<a id="Upgrades-getAdminAddress-address-"></a>

### `getAdminAddress(address proxy) ‚Üí address`
*internal*

Gets the admin address of a transparent proxy from its ERC1967 admin storage slot.

<a id="Upgrades-getImplementationAddress-address-"></a>

### `getImplementationAddress(address proxy) ‚Üí address`
*internal*

Gets the implementation address of a transparent or UUPS proxy from its ERC1967 implementation storage slot.

<a id="Upgrades-getBeaconAddress-address-"></a>

### `getBeaconAddress(address proxy) ‚Üí address`
*internal*

Gets the beacon address of a beacon proxy from its ERC1967 beacon storage slot.

<a id="UnsafeUpgrades"></a>

### `UnsafeUpgrades` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Upgrades.sol)

```solidity
import "@openzeppelin/src/Upgrades.sol";
```

Library for deploying and managing upgradeable contracts from Forge tests, without validations.

Can be used with `forge coverage`. Requires implementation contracts to be instantiated first.
Does not require `--ffi` and does not require a clean compilation before each run.

Not supported for OpenZeppelin Defender deployments.

WARNING: Not recommended for use in Forge scripts.
`UnsafeUpgrades` does not validate whether your contracts are upgrade safe or whether new implementations are compatible with previous ones.
Use `Upgrades` if you want validations to be run.

NOTE: Requires OpenZeppelin Contracts v5 or higher.

#### Functions
- [deployUUPSProxy(impl, initializerData)](#UnsafeUpgrades-deployUUPSProxy-address-bytes-)
- [deployTransparentProxy(impl, initialOwner, initializerData)](#UnsafeUpgrades-deployTransparentProxy-address-address-bytes-)
- [upgradeProxy(proxy, newImpl, data)](#UnsafeUpgrades-upgradeProxy-address-address-bytes-)
- [upgradeProxy(proxy, newImpl, data, tryCaller)](#UnsafeUpgrades-upgradeProxy-address-address-bytes-address-)
- [deployBeacon(impl, initialOwner)](#UnsafeUpgrades-deployBeacon-address-address-)
- [upgradeBeacon(beacon, newImpl)](#UnsafeUpgrades-upgradeBeacon-address-address-)
- [upgradeBeacon(beacon, newImpl, tryCaller)](#UnsafeUpgrades-upgradeBeacon-address-address-address-)
- [deployBeaconProxy(beacon, data)](#UnsafeUpgrades-deployBeaconProxy-address-bytes-)
- [getAdminAddress(proxy)](#UnsafeUpgrades-getAdminAddress-address-)
- [getImplementationAddress(proxy)](#UnsafeUpgrades-getImplementationAddress-address-)
- [getBeaconAddress(proxy)](#UnsafeUpgrades-getBeaconAddress-address-)

<a id="UnsafeUpgrades-deployUUPSProxy-address-bytes-"></a>

### `deployUUPSProxy(address impl, bytes initializerData) ‚Üí address`
*internal*

Deploys a UUPS proxy using the given contract address as the implementation.

<a id="UnsafeUpgrades-deployTransparentProxy-address-address-bytes-"></a>

### `deployTransparentProxy(address impl, address initialOwner, bytes initializerData) ‚Üí address`
*internal*

Deploys a transparent proxy using the given contract address as the implementation.

<a id="UnsafeUpgrades-upgradeProxy-address-address-bytes-"></a>

### `upgradeProxy(address proxy, address newImpl, bytes data)`
*internal*

Upgrades a proxy to a new implementation contract address. Only supported for UUPS or transparent proxies.

<a id="UnsafeUpgrades-upgradeProxy-address-address-bytes-address-"></a>

### `upgradeProxy(address proxy, address newImpl, bytes data, address tryCaller)`
*internal*

Upgrades a proxy to a new implementation contract address. Only supported for UUPS or transparent proxies.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="UnsafeUpgrades-deployBeacon-address-address-"></a>

### `deployBeacon(address impl, address initialOwner) ‚Üí address`
*internal*

Deploys an upgradeable beacon using the given contract address as the implementation.

<a id="UnsafeUpgrades-upgradeBeacon-address-address-"></a>

### `upgradeBeacon(address beacon, address newImpl)`
*internal*

Upgrades a beacon to a new implementation contract address.

<a id="UnsafeUpgrades-upgradeBeacon-address-address-address-"></a>

### `upgradeBeacon(address beacon, address newImpl, address tryCaller)`
*internal*

Upgrades a beacon to a new implementation contract address.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="UnsafeUpgrades-deployBeaconProxy-address-bytes-"></a>

### `deployBeaconProxy(address beacon, bytes data) ‚Üí address`
*internal*

Deploys a beacon proxy using the given beacon and call data.

<a id="UnsafeUpgrades-getAdminAddress-address-"></a>

### `getAdminAddress(address proxy) ‚Üí address`
*internal*

Gets the admin address of a transparent proxy from its ERC1967 admin storage slot.

<a id="UnsafeUpgrades-getImplementationAddress-address-"></a>

### `getImplementationAddress(address proxy) ‚Üí address`
*internal*

Gets the implementation address of a transparent or UUPS proxy from its ERC1967 implementation storage slot.

<a id="UnsafeUpgrades-getBeaconAddress-address-"></a>

### `getBeaconAddress(address proxy) ‚Üí address`
*internal*

Gets the beacon address of a beacon proxy from its ERC1967 beacon storage slot.


## LegacyUpgrades.sol

```solidity
import "@openzeppelin/src/LegacyUpgrades.sol";
```

Library for managing upgradeable contracts from Forge scripts or tests.

NOTE: Only for upgrading existing deployments using OpenZeppelin Contracts v4.
For new deployments, use OpenZeppelin Contracts v5 and Upgrades.sol.

#### Functions
- [upgradeProxy(proxy, contractName, data, opts)](#Upgrades-upgradeProxy-address-string-bytes-struct-Options-)
- [upgradeProxy(proxy, contractName, data)](#Upgrades-upgradeProxy-address-string-bytes-)
- [upgradeProxy(proxy, contractName, data, opts, tryCaller)](#Upgrades-upgradeProxy-address-string-bytes-struct-Options-address-)
- [upgradeProxy(proxy, contractName, data, tryCaller)](#Upgrades-upgradeProxy-address-string-bytes-address-)
- [upgradeBeacon(beacon, contractName, opts)](#Upgrades-upgradeBeacon-address-string-struct-Options-)
- [upgradeBeacon(beacon, contractName)](#Upgrades-upgradeBeacon-address-string-)
- [upgradeBeacon(beacon, contractName, opts, tryCaller)](#Upgrades-upgradeBeacon-address-string-struct-Options-address-)
- [upgradeBeacon(beacon, contractName, tryCaller)](#Upgrades-upgradeBeacon-address-string-address-)
- [validateUpgrade(contractName, opts)](#Upgrades-validateUpgrade-string-struct-Options-)
- [prepareUpgrade(contractName, opts)](#Upgrades-prepareUpgrade-string-struct-Options-)
- [getAdminAddress(proxy)](#Upgrades-getAdminAddress-address-)
- [getImplementationAddress(proxy)](#Upgrades-getImplementationAddress-address-)
- [getBeaconAddress(proxy)](#Upgrades-getBeaconAddress-address-)

<a id="Upgrades-upgradeProxy-address-string-bytes-struct-Options-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data, struct Options opts)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeProxy-address-string-bytes-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeProxy-address-string-bytes-struct-Options-address-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data, struct Options opts, address tryCaller)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-upgradeProxy-address-string-bytes-address-"></a>

### `upgradeProxy(address proxy, string contractName, bytes data, address tryCaller)`
*internal*

Upgrades a proxy to a new implementation contract. Only supported for UUPS or transparent proxies.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-upgradeBeacon-address-string-struct-Options-"></a>

### `upgradeBeacon(address beacon, string contractName, struct Options opts)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeBeacon-address-string-"></a>

### `upgradeBeacon(address beacon, string contractName)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-upgradeBeacon-address-string-struct-Options-address-"></a>

### `upgradeBeacon(address beacon, string contractName, struct Options opts, address tryCaller)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-upgradeBeacon-address-string-address-"></a>

### `upgradeBeacon(address beacon, string contractName, address tryCaller)`
*internal*

Upgrades a beacon to a new implementation contract.

Requires that either the `referenceContract` option is set, or the new implementation contract has a `@custom:oz-upgrades-from <reference>` annotation.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="Upgrades-validateUpgrade-string-struct-Options-"></a>

### `validateUpgrade(string contractName, struct Options opts)`
*internal*

Validates a new implementation contract in comparison with a reference contract, but does not deploy it.

Requires that either the `referenceContract` option is set, or the contract has a `@custom:oz-upgrades-from <reference>` annotation.

<a id="Upgrades-prepareUpgrade-string-struct-Options-"></a>

### `prepareUpgrade(string contractName, struct Options opts) ‚Üí address`
*internal*

Validates a new implementation contract in comparison with a reference contract, deploys the new implementation contract,
and returns its address.

Requires that either the `referenceContract` option is set, or the contract has a `@custom:oz-upgrades-from <reference>` annotation.

Use this method to prepare an upgrade to be run from an admin address you do not control directly or cannot use from your deployment environment.

<a id="Upgrades-getAdminAddress-address-"></a>

### `getAdminAddress(address proxy) ‚Üí address`
*internal*

Gets the admin address of a transparent proxy from its ERC1967 admin storage slot.

<a id="Upgrades-getImplementationAddress-address-"></a>

### `getImplementationAddress(address proxy) ‚Üí address`
*internal*

Gets the implementation address of a transparent or UUPS proxy from its ERC1967 implementation storage slot.

<a id="Upgrades-getBeaconAddress-address-"></a>

### `getBeaconAddress(address proxy) ‚Üí address`
*internal*

Gets the beacon address of a beacon proxy from its ERC1967 beacon storage slot.

<a id="UnsafeUpgrades"></a>

### `UnsafeUpgrades` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/LegacyUpgrades.sol)

```solidity
import "@openzeppelin/src/LegacyUpgrades.sol";
```

Library for managing upgradeable contracts from Forge tests, without validations.

Can be used with `forge coverage`. Requires implementation contracts to be instantiated first.
Does not require `--ffi` and does not require a clean compilation before each run.

Not supported for OpenZeppelin Defender deployments.

WARNING: Not recommended for use in Forge scripts.
`UnsafeUpgrades` does not validate whether your contracts are upgrade safe or whether new implementations are compatible with previous ones.
Use `Upgrades` if you want validations to be run.

NOTE: Only for upgrading existing deployments using OpenZeppelin Contracts v4.
For new deployments, use OpenZeppelin Contracts v5 and Upgrades.sol.

#### Functions
- [upgradeProxy(proxy, newImpl, data)](#UnsafeUpgrades-upgradeProxy-address-address-bytes-)
- [upgradeProxy(proxy, newImpl, data, tryCaller)](#UnsafeUpgrades-upgradeProxy-address-address-bytes-address-)
- [upgradeBeacon(beacon, newImpl)](#UnsafeUpgrades-upgradeBeacon-address-address-)
- [upgradeBeacon(beacon, newImpl, tryCaller)](#UnsafeUpgrades-upgradeBeacon-address-address-address-)
- [getAdminAddress(proxy)](#UnsafeUpgrades-getAdminAddress-address-)
- [getImplementationAddress(proxy)](#UnsafeUpgrades-getImplementationAddress-address-)
- [getBeaconAddress(proxy)](#UnsafeUpgrades-getBeaconAddress-address-)

<a id="UnsafeUpgrades-upgradeProxy-address-address-bytes-"></a>

### `upgradeProxy(address proxy, address newImpl, bytes data)`
*internal*

Upgrades a proxy to a new implementation contract address. Only supported for UUPS or transparent proxies.

<a id="UnsafeUpgrades-upgradeProxy-address-address-bytes-address-"></a>

### `upgradeProxy(address proxy, address newImpl, bytes data, address tryCaller)`
*internal*

Upgrades a proxy to a new implementation contract address. Only supported for UUPS or transparent proxies.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="UnsafeUpgrades-upgradeBeacon-address-address-"></a>

### `upgradeBeacon(address beacon, address newImpl)`
*internal*

Upgrades a beacon to a new implementation contract address.

<a id="UnsafeUpgrades-upgradeBeacon-address-address-address-"></a>

### `upgradeBeacon(address beacon, address newImpl, address tryCaller)`
*internal*

Upgrades a beacon to a new implementation contract address.

This function provides an additional `tryCaller` parameter to test an upgrade using a specific caller address.
Use this if you encounter `OwnableUnauthorizedAccount` errors in your tests.

<a id="UnsafeUpgrades-getAdminAddress-address-"></a>

### `getAdminAddress(address proxy) ‚Üí address`
*internal*

Gets the admin address of a transparent proxy from its ERC1967 admin storage slot.

<a id="UnsafeUpgrades-getImplementationAddress-address-"></a>

### `getImplementationAddress(address proxy) ‚Üí address`
*internal*

Gets the implementation address of a transparent or UUPS proxy from its ERC1967 implementation storage slot.

<a id="UnsafeUpgrades-getBeaconAddress-address-"></a>

### `getBeaconAddress(address proxy) ‚Üí address`
*internal*

Gets the beacon address of a beacon proxy from its ERC1967 beacon storage slot.


## Defender.sol

### `Defender` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Defender.sol)

```solidity
import "@openzeppelin/src/Defender.sol";
```

Library for interacting with OpenZeppelin Defender from Forge scripts or tests.

#### Functions
- [deployContract(contractName)](#Defender-deployContract-string-)
- [deployContract(contractName, defenderOpts)](#Defender-deployContract-string-struct-DefenderOptions-)
- [deployContract(contractName, constructorData)](#Defender-deployContract-string-bytes-)
- [deployContract(contractName, constructorData, defenderOpts)](#Defender-deployContract-string-bytes-struct-DefenderOptions-)
- [proposeUpgrade(proxyAddress, newImplementationContractName, opts)](#Defender-proposeUpgrade-address-string-struct-Options-)
- [getDeployApprovalProcess()](#Defender-getDeployApprovalProcess--)
- [getUpgradeApprovalProcess()](#Defender-getUpgradeApprovalProcess--)

<a id="Defender-deployContract-string-"></a>

### `deployContract(string contractName) ‚Üí address`
*internal*

Deploys a contract to the current network using OpenZeppelin Defender.

WARNING: Do not use this function directly if you are deploying an upgradeable contract. This function does not validate whether the contract is upgrade safe.

NOTE: If using an EOA or Safe to deploy, go to [Defender deploy](https://defender.openzeppelin.com/v2/#/deploy) to submit the pending deployment while the script is running.
The script waits for the deployment to complete before it continues.

<a id="Defender-deployContract-string-struct-DefenderOptions-"></a>

### `deployContract(string contractName, struct DefenderOptions defenderOpts) ‚Üí address`
*internal*

Deploys a contract to the current network using OpenZeppelin Defender.

WARNING: Do not use this function directly if you are deploying an upgradeable contract. This function does not validate whether the contract is upgrade safe.

NOTE: If using an EOA or Safe to deploy, go to [Defender deploy](https://defender.openzeppelin.com/v2/#/deploy) to submit the pending deployment while the script is running.
The script waits for the deployment to complete before it continues.

<a id="Defender-deployContract-string-bytes-"></a>

### `deployContract(string contractName, bytes constructorData) ‚Üí address`
*internal*

Deploys a contract with constructor arguments to the current network using OpenZeppelin Defender.

WARNING: Do not use this function directly if you are deploying an upgradeable contract. This function does not validate whether the contract is upgrade safe.

NOTE: If using an EOA or Safe to deploy, go to [Defender deploy](https://defender.openzeppelin.com/v2/#/deploy) to submit the pending deployment while the script is running.
The script waits for the deployment to complete before it continues.

<a id="Defender-deployContract-string-bytes-struct-DefenderOptions-"></a>

### `deployContract(string contractName, bytes constructorData, struct DefenderOptions defenderOpts) ‚Üí address`
*internal*

Deploys a contract with constructor arguments to the current network using OpenZeppelin Defender.

WARNING: Do not use this function directly if you are deploying an upgradeable contract. This function does not validate whether the contract is upgrade safe.

NOTE: If using an EOA or Safe to deploy, go to [Defender deploy](https://defender.openzeppelin.com/v2/#/deploy) to submit the pending deployment while the script is running.
The script waits for the deployment to complete before it continues.

<a id="Defender-proposeUpgrade-address-string-struct-Options-"></a>

### `proposeUpgrade(address proxyAddress, string newImplementationContractName, struct Options opts) ‚Üí struct ProposeUpgradeResponse`
*internal*

Proposes an upgrade to an upgradeable proxy using OpenZeppelin Defender.

This function validates a new implementation contract in comparison with a reference contract, deploys the new implementation contract using Defender,
and proposes an upgrade to the new implementation contract using an upgrade approval process on Defender.

Supported for UUPS or Transparent proxies. Not currently supported for beacon proxies or beacons.
For beacons, use `Upgrades.prepareUpgrade` along with a transaction proposal on Defender to upgrade the beacon to the deployed implementation.

Requires that either the `referenceContract` option is set, or the contract has a `@custom:oz-upgrades-from <reference>` annotation.

WARNING: Ensure that the reference contract is the same as the current implementation contract that the proxy is pointing to.
This function does not validate that the reference contract is the current implementation.

NOTE: If using an EOA or Safe to deploy, go to [Defender deploy](https://defender.openzeppelin.com/v2/#/deploy) to submit the pending deployment of the new implementation contract while the script is running.
The script waits for the deployment to complete before it continues.

<a id="Defender-getDeployApprovalProcess--"></a>

### `getDeployApprovalProcess() ‚Üí struct ApprovalProcessResponse`
*internal*

Gets the default deploy approval process configured for your deployment environment on OpenZeppelin Defender.

<a id="Defender-getUpgradeApprovalProcess--"></a>

### `getUpgradeApprovalProcess() ‚Üí struct ApprovalProcessResponse`
*internal*

Gets the default upgrade approval process configured for your deployment environment on OpenZeppelin Defender.
For example, this is useful for determining the default multisig wallet that you can use in your scripts to assign as the owner of your proxy.

<a id="ProposeUpgradeResponse"></a>

### `ProposeUpgradeResponse` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Defender.sol)

```solidity
import "@openzeppelin/src/Defender.sol";
```

<a id="ApprovalProcessResponse"></a>

### `ApprovalProcessResponse` [üìÅ](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v0.4.0/src/Defender.sol)

```solidity
import "@openzeppelin/src/Defender.sol";
```
