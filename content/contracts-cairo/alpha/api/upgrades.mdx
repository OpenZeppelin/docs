---
title: Upgrades
---

import { UMBRELLA_VERSION } from "../utils/constants.js";

This crate provides interfaces and utilities related to upgradeability.

## [](#interfaces)Interfaces

<Callout type='info'>
Starting from version `3.x.x`, the interfaces are no longer part of the `openzeppelin_access` package. The references
documented here are contained in the `openzeppelin_interfaces` package version `{{openzeppelin_interfaces_version}}`.
</Callout>

### [](#IUpgradeable)`IUpgradeable` [toc] [#IUpgradeable]

<APIGithubLinkHeader moduleName="IUpgradeable" link={`https://github.com/OpenZeppelin/cairo-contracts/blob/${UMBRELLA_VERSION}/packages/interfaces/src/upgrades.cairo`} />

```rust
use openzeppelin_interfaces::upgrades::IUpgradeable;
```

Interface of an upgradeable contract.

Functions

- [`upgrade(new_class_hash)`](#IUpgradeable-upgrade)

#### [](#IUpgradeable-Functions)Functions [!toc]

<APIItem
  functionSignature="upgrade(new_class_hash: ClassHash)"
  id="IUpgradeable-upgrade"
  kind="external"
>
Upgrades the contract code by updating its [class hash](https://docs.starknet.io/architecture-and-concepts/smart-contracts/class-hash/).

This function is usually protected by an [Access Control](../access) mechanism.
</APIItem>

### [](#IUpgradeAndCall)`IUpgradeAndCall` [toc] [#IUpgradeAndCall]

<APIGithubLinkHeader moduleName="IUpgradeAndCall" link={`https://github.com/OpenZeppelin/cairo-contracts/blob/${UMBRELLA_VERSION}/packages/interfaces/src/upgrades.cairo`} />

```rust
use openzeppelin_interfaces::upgrades::IUpgradeAndCall;
```

Interface for an upgradeable contract that couples an upgrade with a function call in the upgraded context.

Functions

- [`upgrade_and_call(new_class_hash, selector, calldata)`](#IUpgradeAndCall-upgrade_and_call)

#### [](#IUpgradeAndCall-Functions)Functions [!toc]

<APIItem
  functionSignature="upgrade_and_call(new_class_hash: ClassHash, selector: felt252, calldata: Span<felt252>) → Span<felt252>"
  id="IUpgradeAndCall-upgrade_and_call"
  kind="external"
>
Upgrades the contract code by updating its [class hash](https://docs.starknet.io/architecture-and-concepts/smart-contracts/class-hash/) and calls `selector` with the upgraded context.

This function is usually protected by an [Access Control](../access) mechanism.
</APIItem>

## [](#core)Core

### [](#UpgradeableComponent)`UpgradeableComponent` [toc] [#UpgradeableComponent]

<APIGithubLinkHeader moduleName="UpgradeableComponent" link={`https://github.com/OpenZeppelin/cairo-contracts/blob/${UMBRELLA_VERSION}/packages/upgrades/src/upgradeable.cairo`} />

```rust
use openzeppelin_upgrades::upgradeable::UpgradeableComponent;
```

Upgradeable component.

Internal Implementations

InternalImpl

- [`upgrade(self, new_class_hash)`](#UpgradeableComponent-upgrade)
- [`upgrade_and_call(self, new_class_hash, selector, calldata)`](#UpgradeableComponent-upgrade_and_call)

Events

- [`Upgraded(class_hash)`](#UpgradeableComponent-Upgraded)

#### [](#UpgradeableComponent-Internal-Functions)Internal Functions [!toc]

<APIItem
  functionSignature="upgrade(ref self: ContractState, new_class_hash: ClassHash)"
  id="UpgradeableComponent-upgrade"
  kind="internal"
>
Upgrades the contract by updating the contract [class hash](https://docs.starknet.io/architecture-and-concepts/smart-contracts/class-hash/).

Requirements:

- `new_class_hash` must be different from zero.

Emits an [Upgraded](#UpgradeableComponent-Upgraded) event.
</APIItem>

<APIItem
  functionSignature="upgrade_and_call(ref self: ContractState, new_class_hash: ClassHash, selector: felt252, calldata: Span<felt252>) → Span<felt252>"
  id="UpgradeableComponent-upgrade_and_call"
  kind="internal"
>
Replaces the contract's class hash with `new_class_hash` and then calls `selector` from the upgraded context. This function returns the unwrapped `call_contract_syscall` return value(s), if available, of the `selector` call.

Requirements:

- `new_class_hash` must be different from zero.

The function call comes from the upgraded contract itself and not the account.

A similar behavior to `upgrade_and_call` can also be achieved with a list of calls from an account since the [SNIP-6](https://github.com/starknet-io/SNIPs/blob/main/SNIPS/snip-6.md) account standard supports multicall. An account can execute a list of calls with [upgrade](#IUpgradeable-upgrade) being the first element in the list and the extra function call as the second. With this approach, the calls will execute from the account's context and can't be front-ran.

Emits an [Upgraded](#UpgradeableComponent-Upgraded) event.
</APIItem>

#### [](#UpgradeableComponent-Events)Events [!toc]

<APIItem
  functionSignature="Upgraded(class_hash: ClassHash)"
  id="UpgradeableComponent-Upgraded"
  kind="event"
>
Emitted when the [class hash](https://docs.starknet.io/architecture-and-concepts/smart-contracts/class-hash/) is upgraded.
</APIItem>
